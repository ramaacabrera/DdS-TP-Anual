openapi: 3.0.0
info:
  title: API de Estadísticas
  description: API para obtener estadísticas relacionadas con colecciones, categorías, provincias, análisis de solicitudes y exportación de reportes.
  version: 2.0.0

servers:
  - url: http://localhost:8088/api/estadisticas

paths:
  /provinciaMax/colecciones/{coleccion}:
    get:
      summary: Obtener Provincia con Máxima Colección
      description: Retorna la provincia que tiene la máxima cantidad de elementos en una colección específica
      operationId: getProvinciaColeccion
      tags:
        - Estadísticas
      parameters:
        - name: coleccion
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: UUID de la colección a consultar
          example: "123e4567-e89b-12d3-a456-426614174000"
      responses:
        '200':
          description: Solicitud exitosa
          content:
            application/json:
              schema:
                type: object
                properties:
                  provincia:
                    type: string
                    example: "Buenos Aires"
                  nombre:
                    type: string
                    example: "Nombre de la colección"
        '400':
          description: UUID de colección inválido
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Colección no encontrada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DetailedErrorResponse'

  /categoriaMax:
    get:
      summary: Obtener Categoría con Máximo Valor
      description: Retorna la categoría con el valor máximo según las métricas del sistema
      operationId: getCategoriaMax
      tags:
        - Estadísticas
      responses:
        '200':
          description: Solicitud exitosa
          content:
            application/json:
              schema:
                type: object
                properties:
                  categoria:
                    type: string
                    example: "Tecnología"
        '404':
          description: Categoría no encontrada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error interno del servidor

  /provinciaMax/categorias/{categoria}:
    get:
      summary: Obtener Provincia con Máxima Categoría
      description: Retorna la provincia que tiene el máximo valor para una categoría específica
      operationId: getProvinciaCategoria
      tags:
        - Estadísticas
      parameters:
        - name: categoria
          in: path
          required: true
          schema:
            type: string
          description: Nombre de la categoría a consultar
          example: "tecnologia"
      responses:
        '200':
          description: Solicitud exitosa
          content:
            application/json:
              schema:
                type: object
                properties:
                  provincia:
                    type: string
                    example: "Córdoba"
                  categoria:
                    type: string
                    example: "tecnologia"
        '400':
          description: Categoría no especificada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: No se encontraron datos para la categoría
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "No se encontraron datos para la categoría: tecnologia"
                  status:
                    type: integer
                    example: 404
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DetailedErrorResponse'

  /horaMax/categorias/{categoria}:
    get:
      summary: Obtener Hora Máxima por Categoría
      description: Retorna la hora del día con máxima actividad para una categoría específica (formato numérico 0-23)
      operationId: getHoraMaxCategoria
      tags:
        - Estadísticas
      parameters:
        - name: categoria
          in: path
          required: true
          schema:
            type: string
          description: Nombre de la categoría a consultar
          example: "tecnologia"
      responses:
        '200':
          description: Solicitud exitosa
          content:
            application/json:
              schema:
                type: object
                properties:
                  hora:
                    type: integer
                    minimum: 0
                    maximum: 23
                    description: Hora del día en formato numérico (0-23)
                    example: 14
                  categoria:
                    type: string
                    example: "tecnologia"
        '400':
          description: Categoría no especificada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: No se encontraron datos para la categoría
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "No se encontraron datos para la categoría: tecnologia"
                  status:
                    type: integer
                    example: 404
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DetailedErrorResponse'

  /solicitudesSpam:
    get:
      summary: Obtener Cantidad de Solicitudes Spam
      description: Retorna la cantidad total de solicitudes identificadas como spam
      operationId: getSolicitudesSpam
      tags:
        - Estadísticas
      responses:
        '200':
          description: Solicitud exitosa
          content:
            application/json:
              schema:
                type: object
                properties:
                  spam:
                    type: integer
                    format: int64
                    example: 45
                    description: Cantidad total de solicitudes spam
        '404':
          description: Cantidad de spam no encontrada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error interno del servidor

  /categorias:
    get:
      summary: Obtener Lista de Categorías
      description: Retorna la lista completa de categorías disponibles en el sistema
      operationId: getCategorias
      tags:
        - Estadísticas
      responses:
        '200':
          description: Solicitud exitosa
          content:
            application/json:
              schema:
                type: object
                properties:
                  categorias:
                    type: array
                    items:
                      type: string
                    example: ["tecnologia", "deportes", "cultura", "salud"]
                  total:
                    type: integer
                    example: 15
                  timestamp:
                    type: string
                    format: date-time
                    description: Fecha y hora de la consulta
        '404':
          description: No se encontraron categorías
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DetailedErrorResponse'

  /exportar:
    get:
      summary: Exportar Estadísticas a CSV
      description: Genera y descarga un archivo en formato CSV conteniendo el reporte completo.
      operationId: exportarEstadisticasCSV
      tags:
        - Exportación
      responses:
        '200':
          description: Archivo CSV generado exitosamente
          content:
            text/csv:
              schema:
                type: string
                format: binary
          headers:
            Content-Disposition:
              description: Indica descarga como archivo adjunto.
              schema:
                type: string
                example: attachment; filename="reporte.csv"
        '404':
          description: No hay estadísticas disponibles
          content:
            text/plain:
              schema:
                type: string
                example: "No hay estadísticas generadas aún."
        '500':
          description: Error al generar el archivo
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DetailedErrorResponse'

components:
  schemas:
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
        status:
          type: integer
    DetailedErrorResponse:
      type: object
      properties:
        error:
          type: string
        detalle:
          type: string

tags:
  - name: Estadísticas
    description: Endpoints para consultar estadísticas del sistema
  - name: Exportación
    description: Endpoints para descarga de reportes